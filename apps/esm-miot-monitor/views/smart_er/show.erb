<%
	
admit = Admit.find params[:id]
patient = admit.patient

data_records = admit.records



report = ERCaseReport.where(:admit_id=>admit.id).first
report = ERCaseReport.new unless report

	
%>
<style>
	table {
	    max-width: 100%;
	}
	.last{
		background:#443;
	}
	</style>
<script src="https://kit.fontawesome.com/13a3acd719.js" crossorigin="anonymous"></script>
<link href="<%=url_for('css/er.css?=22')%>" rel="stylesheet">
    <!--Content-->
    <section>
        <div class="container">
            <!--patient card-->
            <div class="card patient-info">
                <div class="card-body d-flex align-items-center">
				 <div class="col">
				     <h6 class="font-weight-bold" id="patient-name"><%=patient.to_s%></h6>
				     <span class="col p-0 " id="HN">HN: <%=patient.hn%></span>
				     <span class="col p-0 mr-3" id="age">อายุ: <%=patient.to_age_text %> ปี</span>
				     <span class="col p-0" id="gender">เพศ: <%=patient.gender%></span><br>
				     <span class="col p-0" id="gender">Complaint: <%=admit.note%></span>
					 
				 </div>
				 <div class="col text-right">
				     <h6 class="" id="arrival-time">Arrival:
				         <span><%= admit.admit_stamp.strftime("%H:%M")%></span>
				     </h6>
				     <span id="duration">Duration:
				         <span><%= admit.duration[0] %></span>
				     </span>
					 <br/>
					 Room : <%=admit.room_no%> &nbsp;
					 Bed : <%=admit.bed_no%> &nbsp;
					<div class="level-content <%=report.level if report%>" style="float:right">
				
					</div>
				 </div>
                </div>
            </div>
            <!--end of patient card-->
            <!--nurse summary-->
            <h4 class="font-weight-bold mt-4" style="border:0px solid">Nurse Report
			
            <a href="connect?admit_id=<%=admit.id%>" class="btn btn-primary btn-submit d-flex align-items-center justify-content-center" style="float:right">
                <img src="<%=url_for('img/ER/pulse-base.svg') %>" style="opacity:0.5;width:3em" alt="heart" class="pr-3 pulse"/>
                วัดค่า
            </a>&nbsp;
			</h4>
			<div class="clear"></div>
            <div class="card sum-report mt-4 station">
                <div class="card-header card-vital">
                    <strong> General Information</strong>
                </div>
                <div class="card-body">
                    <div class="row">
						<%
							weight = admit.weight
							weight = ' - ' unless weight 
							
							height = admit.height
							height = ' - ' unless height 
							 
							
						%>
                        <div class="col-3">Weight : <%=weight%> kg.</div>
						<div class="col-3">Height : <%=height%> cm.</div>
					</div>
					
				</div>
                <div class="card-header card-vital">
                    <strong> Triage Assessment</strong>
                </div>
                <div class="card-body">
			        <div class="row">
                        <div class="col-4"><%= admit.admit_stamp.strftime("%H:%M")  %></div>
                        <div class="col-8">
                         	
							Admit เข้าระบบ
						 
                        </div>
                    </div>
					<%
						
					nurse_records = NurseRecord.where(:admit_id=>admit.id).all
						
						for i in nurse_records  
							stamp =  i.start_time.strftime("%H:%M")
					%>
			        <div class="row">
                        <div class="col-4"><%= stamp %></div>
                        <div class="col-8">
                         	
							<%= i.description %>
						 
                        </div>
                    </div>
					<% end %>
            
                </div>
                <!--vital sign part-->
                <div class="card-header card-vital">
                    <strong> Vital Sign</strong>
                </div>
                <div class="card-body">
                    <table class="table table-hover table-vital text-center" style="overflow:hidden;font-size:0.8em">
                        <thead>
                          <tr>
                            <th scope="col">เวลา</th>
                            <th scope="col">BP</th>
                            <th scope="col">Pulse/SpO<sub>2</sub></th>
                            <th scope="col">RR</th>
                            <th scope="col">BT</th>
                    
                            <th scope="col">Score</th>
						    <th scope="col">Staff</th>
                          </tr>
                        </thead>
                        <tbody>
                         
						 <%
						 	   
						 data_records.each_with_index do |i,ix| 
							
						 %>
						 
						  <tr class="<%='last' if ix==data_records.size-1%>">
                            <th scope="row"><%=i.stamp.strftime("%H:%M")%></th>
                            <td class="bp"><%=i.bp%></td>
                            <td class="pr"><%=i.pr%>/<%=i.spo2%></td>
                            <td class="rr"><%=i.rr%></td>
                            <td class="temp"><%=i.temp%></td>
                       
                            <td><%=i.score%></td>
                            <td><%
                            	user = '-'
								user = User.find i.updated_user_id 
								
                            %><%=user.login if user%></td>
                          </tr>
                         
						 <% end  %>
						 
                        </tbody>
                      </table>

                </div>
            </div>


        </div>
        <div class="d-flex justify-content-center mt-5">
			
            <a href="connect?admit_id=<%=admit.id%>" class="btn btn-primary btn-action btn-info d-flex align-items-center justify-content-center" style="float:right">
                <img src="<%=url_for('img/ER/pulse-base.svg') %>" style="opacity:0.5;width:3em" alt="heart" class="pr-3 pulse"/>
                Transfer
            </a>&nbsp;
			
            <a href="edit?admit_id=<%=admit.id%>" class="btn btn-primary btn-action btn-submit d-flex align-items-center justify-content-center">
                <img src="<%=url_for('img/ER/pulse-base.svg') %>" style="opacity:0.5;width:3em" alt="heart" class="pr-3"/>
                Record
            </a>&nbsp;

            <a href="summary?admit_id=<%=admit.id%>" class="btn btn-primary  btn-action btn-danger d-flex align-items-center justify-content-center" style="float:right">
            <img src="<%=url_for('img/ER/pulse-base.svg') %>" style="opacity:0.5;width:3em" alt="heart" class="pr-3 pulse"/>
                Summary
            </a>&nbsp;
        
            <a href="connect?admit_id=<%=admit.id%>" class="btn btn-primary  btn-action btn-danger d-flex align-items-center justify-content-center" style="float:right">
                <img src="<%=url_for('img/ER/pulse-base.svg') %>" style="opacity:0.5;width:3em" alt="heart" class="pr-3 pulse"/>
                Discharge
            </a>

        </div>
        <br>
        <a href="index" class="d-flex justify-content-center">
            <p>กลับสู่หน้าหลัก</p>
        </a>
        </div>
        </div>
    </section>